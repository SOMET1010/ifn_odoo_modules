<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">

        <!-- Record Rules pour res.partner (IFN) -->

        <!-- Règle: Les marchands ne voient que leur propre profil -->
        <record id="rule_partner_merchant_own" model="ir.rule">
            <field name="name">Marchand IFN: profil propre</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="domain_force">[('id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('group_ifn_merchant'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Règle: Les producteurs ne voient que leur propre profil -->
        <record id="rule_partner_producer_own" model="ir.rule">
            <field name="name">Producteur IFN: profil propre</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="domain_force">[('id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('group_ifn_producer'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Règle: Les gestionnaires coop voient les membres de leur coop -->
        <record id="rule_partner_coop_manager_members" model="ir.rule">
            <field name="name">Gestionnaire Coop: membres de sa coop</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="domain_force">[
                '|',
                ('id', '=', user.partner_id.id),
                ('x_ifn_coop_id', '=', user.partner_id.x_ifn_coop_id.id)
            ]</field>
            <field name="groups" eval="[(4, ref('group_ifn_coop_manager'))]"/>
        </record>

        <!-- Règle: Les agents voient tous les partenaires (lecture) mais ne modifient que leur profil -->
        <record id="rule_partner_agent_read" model="ir.rule">
            <field name="name">Agent IFN: lecture tous partenaires</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="domain_force">[]</field>
            <field name="groups" eval="[(4, ref('group_ifn_agent'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="rule_partner_agent_write_own" model="ir.rule">
            <field name="name">Agent IFN: écriture profil propre</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="domain_force">[('id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('group_ifn_agent'))]"/>
            <field name="perm_read" eval="False"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Record Rules pour ifn.market -->

        <!-- Règle: Les utilisateurs IFN voient tous les marchés (lecture seule) -->
        <record id="rule_market_user_read" model="ir.rule">
            <field name="name">Utilisateur IFN: lecture marchés</field>
            <field name="model_id" ref="model_ifn_market"/>
            <field name="domain_force">[]</field>
            <field name="groups" eval="[(4, ref('group_ifn_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Règle: Les agents peuvent modifier les marchés -->
        <record id="rule_market_agent" model="ir.rule">
            <field name="name">Agent IFN: gestion marchés</field>
            <field name="model_id" ref="model_ifn_market"/>
            <field name="domain_force">[]</field>
            <field name="groups" eval="[(4, ref('group_ifn_agent'))]"/>
        </record>

        <!-- Record Rules pour ifn.coop -->

        <!-- Règle: Les utilisateurs voient les coopératives (lecture seule) -->
        <record id="rule_coop_user_read" model="ir.rule">
            <field name="name">Utilisateur IFN: lecture coopératives</field>
            <field name="model_id" ref="model_ifn_coop"/>
            <field name="domain_force">[]</field>
            <field name="groups" eval="[(4, ref('group_ifn_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Règle: Les gestionnaires coop voient/modifient leur coopérative -->
        <record id="rule_coop_manager_own" model="ir.rule">
            <field name="name">Gestionnaire Coop: sa coopérative</field>
            <field name="model_id" ref="model_ifn_coop"/>
            <field name="domain_force">[
                '|',
                ('manager_partner_id', '=', user.partner_id.id),
                ('id', '=', user.partner_id.x_ifn_coop_id.id)
            ]</field>
            <field name="groups" eval="[(4, ref('group_ifn_coop_manager'))]"/>
        </record>

        <!-- Règle: Les agents gèrent toutes les coopératives -->
        <record id="rule_coop_agent" model="ir.rule">
            <field name="name">Agent IFN: gestion coopératives</field>
            <field name="model_id" ref="model_ifn_coop"/>
            <field name="domain_force">[]</field>
            <field name="groups" eval="[(4, ref('group_ifn_agent'))]"/>
        </record>

        <!-- Record Rules pour ifn.zone -->

        <!-- Règle: Lecture seule pour utilisateurs -->
        <record id="rule_zone_user_read" model="ir.rule">
            <field name="name">Utilisateur IFN: lecture zones</field>
            <field name="model_id" ref="model_ifn_zone"/>
            <field name="domain_force">[]</field>
            <field name="groups" eval="[(4, ref('group_ifn_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Règle: Gestion complète pour agents -->
        <record id="rule_zone_agent" model="ir.rule">
            <field name="name">Agent IFN: gestion zones</field>
            <field name="model_id" ref="model_ifn_zone"/>
            <field name="domain_force">[]</field>
            <field name="groups" eval="[(4, ref('group_ifn_agent'))]"/>
        </record>

        <!-- Record Rules pour ifn.product.category.ref -->

        <!-- Règle: Lecture seule pour tous -->
        <record id="rule_product_category_user_read" model="ir.rule">
            <field name="name">Utilisateur IFN: lecture catégories produits</field>
            <field name="model_id" ref="model_ifn_product_category_ref"/>
            <field name="domain_force">[]</field>
            <field name="groups" eval="[(4, ref('group_ifn_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Règle: Gestion pour agents -->
        <record id="rule_product_category_agent" model="ir.rule">
            <field name="name">Agent IFN: gestion catégories produits</field>
            <field name="model_id" ref="model_ifn_product_category_ref"/>
            <field name="domain_force">[]</field>
            <field name="groups" eval="[(4, ref('group_ifn_agent'))]"/>
        </record>

        <!-- Record Rules pour ifn.audit.log -->

        <!-- Règle: Les agents voient tous les logs -->
        <record id="rule_audit_log_agent" model="ir.rule">
            <field name="name">Agent IFN: accès logs audit</field>
            <field name="model_id" ref="model_ifn_audit_log"/>
            <field name="domain_force">[]</field>
            <field name="groups" eval="[(4, ref('group_ifn_agent'))]"/>
        </record>

        <!-- Règle: Les utilisateurs voient seulement leurs propres logs -->
        <record id="rule_audit_log_user_own" model="ir.rule">
            <field name="name">Utilisateur IFN: logs propres</field>
            <field name="model_id" ref="model_ifn_audit_log"/>
            <field name="domain_force">[('user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_ifn_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Record Rules pour ifn.kpi.snapshot -->

        <!-- Règle: Lecture seule pour tous les utilisateurs -->
        <record id="rule_kpi_snapshot_user" model="ir.rule">
            <field name="name">Utilisateur IFN: lecture KPIs</field>
            <field name="model_id" ref="model_ifn_kpi_snapshot"/>
            <field name="domain_force">[]</field>
            <field name="groups" eval="[(4, ref('group_ifn_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Règle: Gestion pour agents -->
        <record id="rule_kpi_snapshot_agent" model="ir.rule">
            <field name="name">Agent IFN: gestion KPIs</field>
            <field name="model_id" ref="model_ifn_kpi_snapshot"/>
            <field name="domain_force">[]</field>
            <field name="groups" eval="[(4, ref('group_ifn_agent'))]"/>
        </record>

        <!-- Règles multi-company isolation -->

        <!-- Isolation par société pour les partenaires IFN -->
        <record id="rule_partner_multi_company" model="ir.rule">
            <field name="name">IFN Partenaire: multi-company</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- Isolation par société pour les marchés -->
        <record id="rule_market_multi_company" model="ir.rule">
            <field name="name">IFN Marché: multi-company</field>
            <field name="model_id" ref="model_ifn_market"/>
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
            <field name="global" eval="True"/>
        </record>

        <!-- Isolation par société pour les coopératives -->
        <record id="rule_coop_multi_company" model="ir.rule">
            <field name="name">IFN Coopérative: multi-company</field>
            <field name="model_id" ref="model_ifn_coop"/>
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
            <field name="global" eval="True"/>
        </record>

    </data>
</odoo>